<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>User Profile</title>
    <link rel="stylesheet" th:href="@{~/css/styles.css}">
</head>
<body>
<nav th:insert="~{fragmentExample/fragments/nav.html}"></nav>
<h1>User Profile</h1>

<div class="UserProfilePicContainer">
    <div class="UserProfilePic">
        <img th:src="@{${'/uploads/' + profilePic}}" alt="Profile Picture">
    </div>
</div>
<div >
    <button class="ChangeProfilePictureButtonContainer" type="button" id="changePicture" onclick=window.location.href='/editProfile'> + </button>
</div>

<div>
    <form id="profileForm" action="/user" method="get">
        <label for="firstName"> First Name: </label>
        <span id="firstName" th:text="${firstName}"></span>
        <input autofocus class="form-control" data-cy="firstName" id="firstNameEdit"
               placeholder="First Name" required th:name="firstName" th:value="*{firstName}" type="text" style="display: none;">
        <p th:text="${firstNameValid}"></p>
        <br/>

        <label for="lastName"> Last Name: </label>
        <span id="lastName" th:text="${lastName}"></span>
        <input class="form-control" data-cy="lastName" id="lastNameEdit" placeholder="Last Name"
               th:name="lastName" th:value="*{lastName}" type="text" style="display: none">
        <br/>
        <input class="form-control" data-cy="lastNameCheck" id="lastNameCheck" name="lastNameCheck" placeholder="Last Name Tick Box Check"
               th:name="lastNameCheck" th:value="lastNameCheck" type="checkbox" style="display: none;">
        <label id="lastNameCheckLabelEdit" style="display: none;">I have no surname</label>
        <script>
            document.getElementById('lastNameCheck').checked = false;
            document.getElementById('lastNameCheck').onchange = function () {
                document.getElementById('lastNameEdit').disabled = this.checked;
            };
        </script>
        <p th:text="${lastNameValid}"></p>
        <br/>

        <label for="DoB"> Date of Birth: </label>
        <span id="DoB" th:text="${DoB}"></span>
        <input class="form-control" data-cy="DoB" id="DoBEdit"
               th:name="DoB" th:value="*{DoB}" type="date" style="display: none;">
        <p id = "DoBInvalid" th:text="${DoBValid}"></p>
        <script>
            document.getElementById( "DoBEdit" ).addEventListener( "invalid",
                function( event ) {
                    event.preventDefault();
                    console.log("invalid date");
                    document.getElementById("DoBInvalid").textContent = "Date is not in valid format, DD/MM/YYYY";
                });
        </script>
        <br/>
        <label for="email"> Email: </label>
        <span id="email" th:text="${email}"></span>
        <input class="form-control" data-cy="email" id="emailEdit" placeholder="Email"
               th:name="email" th:value="*{email}" type="text" style="display: none;">
        <p th:text="${emailValid}"></p>
        <br/>

        <div id="editButtonDiv">
            <button type="button" onclick="enableEditing()">Edit</button>
        </div>
        <div id="saveCancelButtonDiv" style="display: none;">
            <input type="submit" value="Save" onclick="console.log('save')"/>
            <button type="button" onclick="disableEditing()">Cancel</button>
        </div>
    </form>
</div>
<script>

    function redirectToUploadPage() {
        window.location.href = '/upload';
    }
    function enableEditing() {
        document.getElementById('editButtonDiv').style.display = 'none';
        document.getElementById('saveCancelButtonDiv').style.display = 'block';

        document.getElementById('firstName').style.display = 'none';
        document.getElementById('firstNameEdit').style.display = 'inline';

        document.getElementById('lastName').style.display = 'none';
        document.getElementById('lastNameEdit').style.display = 'inline';
        document.getElementById('lastNameCheck').style.display = 'inline';
        document.getElementById('lastNameCheckLabelEdit').style.display = 'inline';
        var lName = document.getElementById('lastNameEdit');
        if (lName.value.trim() === "") {
            document.getElementById('lastNameCheck').checked = true;
            document.getElementById('lastNameEdit').disabled = true;
        }

        document.getElementById('DoB').style.display = 'none';
        document.getElementById('DoBEdit').style.display = 'inline';

        document.getElementById('email').style.display = 'none';
        document.getElementById('emailEdit').style.display = 'inline';

    }

    function disableEditing() {
        document.getElementById('editButtonDiv').style.display = 'block';
        document.getElementById('saveCancelButtonDiv').style.display = 'none';

        document.getElementById('firstName').style.display = 'inline';
        document.getElementById('firstNameEdit').style.display = 'none';

        document.getElementById('lastName').style.display = 'inline';
        document.getElementById('lastNameEdit').style.display = 'none';
        document.getElementById('lastNameCheck').style.display = 'none';
        document.getElementById('lastNameCheckLabelEdit').style.display = 'none';

        document.getElementById('DoB').style.display = 'inline';
        document.getElementById('DoBEdit').style.display = 'none';

        document.getElementById('email').style.display = 'inline';
        document.getElementById('emailEdit').style.display = 'none';

        window.location.href='/user'
    }

</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var firstNameValid = /*[[${firstNameValid}]]*/ '';
    var lastNameValid = /*[[${lastNameValid}]]*/ '';
    var DoBValid = /*[[${DoBValid}]]*/ '';
    var emailValid = /*[[${emailValid}]]*/ '';
    if (firstNameValid !== '' || lastNameValid !== '' || DoBValid !== '' || emailValid !== '') {
        console.log("edit");
        enableEditing();
    }
    /*]]>*/
</script>

</body>
</html>